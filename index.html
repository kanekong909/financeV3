<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gastos Diarios</title>
  <link rel="stylesheet" href="style.css"/> <!-- Cambié a style.css como en tu link -->

  <!-- Solo la librería GSI nueva (suficiente para login + token) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Nota: quitamos apis.google.com/js/api.js porque usaremos fetch + token -->
</head>
<body>
    <!-- Pantalla principal -->
    <div id="main-screen">
        <header>
            <h1>Mis Gastos</h1>
            <button id="signout-btn" class="btn small">Cerrar sesión</button>
        </header>

        <main class="main-content">
            <div class="grid">
            <!-- Columna izquierda: Formulario -->
            <section class="card form-section">
                <h2>Registrar nuevo gasto</h2>
                <!-- Formulario -->
                <form id="expense-form">
                    <div class="form-group">
                        <label for="date">Fecha y hora</label>
                        <input type="datetime-local" id="date" required>
                    </div>

                    <div class="form-group">
                        <label for="amount">Monto</label>
                        <input type="number" id="amount" placeholder="Ej: 15000" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label for="category">Categoría</label>
                        <select id="category" required>
                        <option value="" disabled selected>Selecciona una categoría</option>
                        <option>Comida</option>
                        <option>Transporte</option>
                        <option>Entretenimiento</option>
                        <option>Compras</option>
                        <option>Salud</option>
                        <option>Otro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="description">Descripción</label>
                        <input type="text" id="description" placeholder="Ej: Almuerzo con amigos">
                    </div>

                    <button type="submit" class="btn primary full-width">Agregar gasto</button>
                </form>
            </section>

            <!-- Columna derecha: Resumen + lista + filtros -->
            <section class="card list-section">
                <!-- Resumen -->
                <div class="total-card">
                <h2>Resumen <span id="current-month-name"></span></h2>
                <div id="total-amount">$0</div>
                </div>

                <!-- Filtros -->
                <div class="filters-container">
                <input type="text" id="filter-search" placeholder="Buscar descripción...">
                <select id="filter-category">
                    <option value="All">Todas las categorías</option>
                    <option>Comida</option>
                    <option>Transporte</option>
                    <option>Entretenimiento</option>
                    <option>Compras</option>
                    <option>Salud</option>
                    <option>Otro</option>
                </select>
                </div>

                <!-- Lista de gastos (con scroll controlado) -->
                <div id="expenses-list" class="expenses"></div>
            </section>
            </div>

            <!-- Secciones inferiores (historial, PDF, gráfico) -->
            <div class="bottom-sections">
                <!-- Historial -->
                <div class="history-section">
                    <button type="button" class="btn secondary full-width" id="view-history-btn">
                    Ver meses anteriores
                    </button>
                </div>

                <!-- Exportar PDF -->
                <div class="pdf-section card">
                    <h3>Exportar reporte</h3>
                    <div class="pdf-controls">
                        <div class="form-group">
                            <label>Año</label>
                            <select id="export-year-select"></select>
                        </div>
                        <div class="form-group">
                            <label>Mes</label>
                            <select id="export-month-select"></select>
                        </div>
                        <button type="button" class="btn danger full-width" id="download-pdf-btn">
                            Descargar PDF
                        </button>
                    </div>
                </div>

                <!-- Gráfico -->
                <div class="chart-section card">
                    <h3>Distribución de gastos</h3>
                    <div class="chart-container">
                    <canvas id="expensesChart"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de edición -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
            <h2>Editar Gasto</h2>
            <button type="button" class="modal-close">×</button>
            </div>
            
            <form id="edit-form">
            <div class="form-group">
                <label for="edit-fecha">Fecha y Hora</label>
                <input type="datetime-local" id="edit-fecha" required>
            </div>
            
            <div class="form-group">
                <label for="edit-monto">Monto</label>
                <input type="number" id="edit-monto" step="0.01" required>
            </div>
            
            <div class="form-group">
                <label for="edit-categoria">Categoría</label>
                <select id="edit-categoria" required>
                <option value="Comida">Comida</option>
                <option value="Transporte">Transporte</option>
                <option value="Entretenimiento">Entretenimiento</option>
                <option value="Compras">Compras</option>
                <option value="Salud">Salud</option>
                <option value="Otro">Otro</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="edit-descripcion">Descripción</label>
                <input type="text" id="edit-descripcion">
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn secondary modal-cancel">Cancelar</button>
                <button type="submit" class="btn primary">Guardar Cambios</button>
            </div>
            </form>
        </div>
    </div>

    <!-- Modal de confirmación de eliminación -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>¿Eliminar gasto?</h2>
                <button type="button" class="modal-close" id="close-delete-x">×</button>
            </div>
            <p style="text-align: left; margin-bottom: 2rem;">Esta acción no se puede deshacer. El registro se borrará permanentemente de tu Google Sheets.</p>
            <div class="modal-actions">
                <button type="button" class="btn secondary" id="cancel-delete-btn">Cancelar</button>
                <button type="button" class="btn" style="background-color: var(--error-color); color: white;" id="confirm-delete-btn">Eliminar ahora</button>
            </div>
        </div>
    </div>

    <!-- Modal historial -->
    <div id="history-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;"> <div class="modal-header">
                <h2>Historial Completo</h2>
                <button type="button" class="modal-close" id="close-history">×</button>
            </div>
            
            <div class="filters-container" style="margin-bottom: 20px;">
                <input type="text" id="history-search" placeholder="Buscar en historial...">
            </div>

            <div id="history-list-container" style="max-height: 60vh; overflow-y: auto;">
                </div>
        </div>
    </div>

    <script src="index.js"></script>  <!-- Tu script con la lógica -->
    <!-- PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <!-- ChartJS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>